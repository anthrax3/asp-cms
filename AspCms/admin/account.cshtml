@{
    
    Page.Title = "Account management";
    Layout = "~/admin/_AdminLayout.cshtml";

    var mode = Post.Mode;
    //var slug = Post.Slug;
}

@if (!Post.Mode.IsEmpty())
{

    //var post = Post.Current;
    //var tags = TagRepository.GetAll();
    //var postTags = (IEnumerable<dynamic>)post.Tags;

    <div>
    <form name="account" method="post" action="~/admin/account.ashx">
        <input type="hidden" name="mode" value="@mode" />
        <input type="hidden" name="accountId" value="@post.Id" />
        
        <p>Username: <input type="text" name="accountName" value="@post.Title" /></p>
        <p>Password: <input type="password" name="accountPassword1" value="@post.Content" /></p>
        <p>Password: <input type="password" name="accountPassword2" value="@post.Slug" /></p>
        
        <p>Email: <input type="text" name="accountEmail" value="@Post.Slug" /> </p>
    <p>
        <select name="accountRoles" multiple>
            @foreach (var tag in tags)
            {
               
                <option value="@tag.Id" selected="@postTags.Any(t => t.Id == tag.Id)">@tag.Name</option>
            
            }
        </select>
        </p>
        
         <p><input type="submit" name="postSubmit" value="Submit" /></p>
    </form>
</div>
    
}
else 
{
    var grid = new WebGrid(
        source: PostRepository.GetAll(orderBy: "DateCreated DESC"),
        rowsPerPage: 30
        );
    
    @grid.GetHtml(
    columns: grid.Columns(
        grid.Column(format: @<a href="~/admin/post/edit/@item.Slug">Edit</a>),
        grid.Column(format: @<a href="~/admin/post/delete/@item.Slug">Delete</a>),  
        grid.Column("Title"),
        grid.Column("DateCreated", header: "Date Created"),
        grid.Column("DatePublished", header: "Published"),
        grid.Column("AuthorId", header: "Author")
    )
   );

}

